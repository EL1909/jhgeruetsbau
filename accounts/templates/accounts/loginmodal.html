<div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <ul class="nav nav-tabs" id="loginTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <a class="nav-link active" id="login-tab" data-bs-toggle="tab" href="#loginContent" role="tab" aria-controls="loginContent" aria-selected="true">Anmelden</a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" id="register-tab" data-bs-toggle="tab" href="#signupContent" role="tab" aria-controls="signupContent" aria-selected="false">Konto Erstellen</a>
                    </li>
                </ul>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="tab-content">
                    <!-- Display form errors -->
                    <div class="" id="modalError">
                        <!-- Display the error message here -->
                        ERROR
                    </div>                   
                    <div class="tab-pane fade show active" id="loginContent" role="tabpanel" aria-labelledby="login-tab">
                        {% include 'accounts/login.html' %}
                    </div>
                    <div class="tab-pane fade" id="signupContent" role="tabpanel" aria-labelledby="register-tab">
                        {% include 'accounts/signup.html' %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
$(document).ready(function() {
    // Signup Form error handling
    $('#signupForm').submit(function(event) {
        event.preventDefault(); // Prevent default form submission
        
        $.ajax({
            url: $(this).attr('action'),
            type: $(this).attr('method'),
            data: $(this).serialize(),
            success: function(response) {
                if (response.success) {
                    // Display success message in modal
                    $('#modalError')
                        .text('Account created successfully!')
                        .css('background-color', '#09a70e7a' )
                        .show(); // Show the modal error
                    setTimeout(function() {
                        window.location.href = '/'; // Hide the modal after 2 seconds
                    }, 2000); // 2000 milliseconds = 2 seconds
                } else if (response.errors) {
                    // Display errors in modal
                    var errors = '<ul>';
                    $.each(response.errors, function(field, errors) {
                        $.each(errors, function(index, error) {
                            errors += '<li>' + error + '</li>';
                        });
                    });
                    errors += '</ul>';
                    $('#modalError').html(errors);
                }
            },
            error: function(xhr, status, error) {
                $('#modalError')
                    .html('<strong>Error:</strong>' + xhr.responseText)
                    .css('background-color', '#a7092b7a')
                    .show();
                console.error(xhr.responseText);
            }
        });
    });

    // Login Form error handling
    $('#loginForm').submit(function(event) {
        event.preventDefault(); // Prevent default form submission
        
        $.ajax({
            url: $(this).attr('action'),
            type: $(this).attr('method'),
            data: $(this).serialize(),
            success: function(response) {
                if (response.success) {
                    // Redirect to home page if login successful
                    $('#modalError')
                        .text('{user} Logged in successfully!')
                        .css('background-color', '#09a70e7a' )
                        .show(); // Show the modal error
                    setTimeout(function() {
                        window.location.href = '/'; // Hide the modal after 2 seconds
                    }, 2000); // 2000 milliseconds = 2 seconds
                    window.location.href = '/';
                } else if (response.errors) {
                    // Display errors in modal
                    var errors = '<ul>';
                    $.each(response.errors, function(field, errorList) {
                        $.each(errorList, function(index, error) {
                            errors += '<li>' + error + '</li>';
                        });
                    });
                    errors += '</ul>';
                    $('#modalError').html(errors)
                    .css('background-color', '#a7092b7a')
                    .show(); // Show the modal error
                }
            },
            error: function(xhr, status, error) {
                $('#modalError')
                    .html('<strong>Error:</strong>' + xhr.responseText)
                    .css('background-color', '#a7092b7a')
                    .show();
                console.error(xhr.responseText);
            }
        });
    });
});
</script>